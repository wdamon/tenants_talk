{% load staticfiles %}
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="Add data to the debate, report your eviction">
    <meta name="author" content="William Damon">
    <! <link rel="icon" href="{% static 'favicon.ico' %}">
    <link rel="stylesheet"  href="{% static 'bootstrap.min.css' %}">
    <link rel="stylesheet"  href="{% static 'jumbotron-narrow.css' %}">
    <link href="https://fonts.googleapis.com/css?family=Work+Sans" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.0-rc.3/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.0.0-rc.3/dist/leaflet.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script type="text/javascript" src="{% static 'leaflet-ajax/dist/leaflet.ajax.min.js' %}"></script>
    <script src="{% static 'fuse.js/src/fuse.js' %}"></script>
    <script src="{% static 'leaflet-fusesearch-master/src/leaflet.fusesearch.js' %}"></script>
    <link rel="stylesheet" href="{% static 'leaflet-fusesearch-master/src/leaflet.fusesearch.css' %}">
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css"/>
    <link rel="stylesheet" href="{% static 'leaflet.awesome-markers.css' %}" />
    <script src="{% static 'leaflet.awesome-markers.min.js' %}"></script>
    <script src="https://use.fontawesome.com/2c3856b3e5.js"></script>


    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="{% static 'ie10-viewport-bug-workaround.css' %}" rel="stylesheet">

    <title> Tenants Talk</title>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

  </head>
  <body>
  <div class="container">
     <div class= "row">
         {% for advocate in advocates %}
         <div class="col-md-4">
           <div class="card">
             <div class="header">
               <h4 class="title">{{ advocate.name }}</h4>
               <p><a href= {{ advocate.url }} >{{ advocate.url }}</a></p>
             </div>
             <div class="content">
               {% if advocate.category == "general"  %}
               <div class='panel panel-info'>
                 <div class='panel-heading'>
                {% elif advocate.category == "women" %}
                <div class='panel panel-default'>
                  <div class='panel-heading'>
                {% elif advocate.category == "HIV/AIDS" %}
                <div class='panel panel-default'>
                  <div class='panel-heading panel-heading-custom'>
                {% elif advocate.category == "disability" %}
                <div class='panel panel-success'>
                  <div class='panel-heading'>
                {% elif advocate.category == "immigrant/refugees" %}
                <div class='panel panel-warning'>
                  <div class='panel-heading'>
                {% endif %}
               <h4 class="title"> {{advocate.name}} </h4></div>
               <div class='panel-body'><p> {{advocate.note}} </p>
               <ul class="list-group">
                   <li class="list-group-item"><i class="fa fa-calendar" aria-hidden="true"></i>Schedule: {{advocate.schedule}}</li>
                   <li class="list-group-item"><i class="fa fa-phone-square" aria-hidden="true"></i> Phone: {{advocate.phone}}</li>
                   <li class="list-group-item"><i class="fa fa-info-circle" aria-hidden="true"></i> Website: <a href={{advocate.url}}>{{advocate.url}}</a></li>
                   <li class="list-group-item"><i class="fa fa-map-marker" aria-hidden="true"></i>Address: {{advocate.address}} =</li>
              </ul>
            </div>
          </div>
         </div>
         {% if forloop.counter|divisibleby: 3 %}
          </div><div class="row">
         {% endif %}
        {% endfor %}
      </div>
</main>
    <div class="container">
      <div class="header clearfix">
        <nav style="background-color: black" class="navbar navbar-inverse">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <h3 style="color: white">Tenants Talk</h3>
            </div>

            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav nav-pills pull-right">
                    <input type="hidden" id="selected_menu_item" value="=$selectedMenuId; ?>" />
                    <li role="presentation" ><a href="{% url 'index' %}">Report a Landlord</a></li>
                    <li role="presentation" class="active"><a href="{% url 'map' %}">Tenant Complaint Registry</a></li>
                    <li role="presentation"><a href="/contest">Tenant Robot Lawyer</a></li>
                </ul>
          </div>
      </nav>
    </div>
  </div>
      <div class="container" style="max-width:100%">
        <div class="jumbotron">
          <h1>Find an Advocate</h1>
            <div class="row">
            <div id="mapid" style="height:80%">
              <script>
              //initialize map
              var m  = L.map('mapid').setView([49.251624, -123.081344], 11);

              var mopt = {
                  url:'https://api.tiles.mapbox.com/v4/wdamon.1c70m0jc/{z}/{x}/{y}.png?access_token=pk.eyJ1Ijoid2RhbW9uIiwiYSI6InFVV1VLMFUifQ.2Zx0T9w01EK6E-v76-z85Q',
                  options: {attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>, Icons: Font Awesome by Dave Gandy - http://fontawesome.io, Search Box: Antoine Riche - https://github.com/naomap/leaflet-fusesearch'}
                };

              var mq=L.tileLayer(mopt.url,mopt.options);

              mq.addTo(m);
              //organize layers
              var layers = {},
                  masterLayer = L.layerGroup();

              var genGroup = L.featureGroup();
              masterLayer.addLayer(genGroup);
              var womGroup = L.featureGroup();
              masterLayer.addLayer(womGroup);
              var hivGroup = L.featureGroup();
              masterLayer.addLayer(hivGroup);

              var baseMaps = {
                "Basemap": mq
              };

              var overlayMaps = {
                "General" : genGroup,
                "Womens": womGroup,
                "HIV/AIDS": hivGroup,
              };
              L.control.layers(baseMaps, overlayMaps, {hideSingleBase: 'true', position: 'bottomright'}).addTo(m);

              masterLayer.addTo(m);

              var searchCtrl = L.control.fuseSearch();
              searchCtrl.addTo(m);

              var geojsonPointLayer = {{ arb_serialized|safe }};

              var genIcon = L.AwesomeMarkers.icon({
                  icon: 'briefcase',
                  prefix: 'fa',
                  markerColor: 'blue',
                  iconColor: 'white',
                  riseOnHover: 'True'

                });
              var womIcon = L.AwesomeMarkers.icon({
                    icon: 'briefcase',
                    prefix: 'fa',
                    markerColor: 'white',
                    iconColor: 'green',
                    riseOnHover: 'True'
                });
              var hivIcon = L.AwesomeMarkers.icon({
                    icon: 'briefcase',
                    prefix: 'fa',
                    markerColor: 'black',
                    iconColor: 'white',
                    riseOnHover: 'True'
                });
              function getMarker(f, name) {
                if (f === 'general') {
                    return {icon: genIcon,
                            title: name}
                } else if (f === 'women') {
                    return {icon: womIcon,
                            title: name}
                } else if (f === 'HIV/AIDS') {
                    return {icon: hivIcon,
                            title: name}
                }
              var popup = L.DomUtil.create('div', 'tiny-popup', m.getContainer());
              var popupcontents =   "<div class='panel panel-info'><div class='panel-heading'>" + feature.properties.name + "</div><div class='panel-body'><p>" + feature.properties.note + '</p></div><ul class="list-group"><li class="list-group-item">Schedule: ' + feature.properties.schedule + '</li><li class="list-group-item">Phone: ' + feature.properties.phone +  '</li><li class="list-group-item">Website: <a href=' + feature.properties.url + '>' + feature.properties.url + '</a></li><li class="list-group-item">Address: ' + feature.properties.address + '</li></ul></div>';

              var geojsonPointLayerJSON = new L.geoJson(geojsonPointLayer, {
                pointToLayer: function(feature, latlng) {
                  if (feature.properties.category === "general") {
                    var marker = L.marker(latlng, getMarker(feature.properties.category, feature.properties.name)).bindPopup(popupcontents);
                    feature.layer = marker;
                    genGroup.addLayer(marker);
                  }  else if (feature.properties.category === "women") {
                    var marker = L.marker(latlng, getMarker(feature.properties.category, feature.properties.name)).bindPopup(popupcontents);
                    feature.layer = marker;
                    womGroup.addLayer(marker);
                    } else if (feature.properties.category === "HIV/AIDS") {
                    var marker = L.marker(latlng, getMarker(feature.properties.category, feature.properties.name)).bindPopup(popupcontents);
                    feature.layer = marker;
                    hivGroup.addLayer(marker);
              },
            });


            searchCtrl.indexFeatures(geojsonPointLayer, ['name', 'address', 'phone']);


              </script>

            </div>
          </div>

</div>
      </div>

      <footer class="footer">
        <p>&copy; <a href="www.wgdamon.com">William Damon</a> 2016</p>
      </footer>

    </div> <!-- /container -->


    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="{% static 'ie10-viewport-bug-workaround.js' %}"></script>
  </body>
</html>

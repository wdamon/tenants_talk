{% load staticfiles %}
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="Add data to the debate, report your eviction">
    <meta name="author" content="William Damon">
    <!--link rel="icon" href="{% static 'favicon.ico' %}"-->
    <link rel="stylesheet"  href="{% static 'bootstrap.min.css' %}">
    <link rel="stylesheet"  href="{% static 'jumbotron-narrow.css' %}">
    <link href="https://fonts.googleapis.com/css?family=Work+Sans" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.0-rc.3/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.0.0-rc.3/dist/leaflet.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script type="text/javascript" src="{% static 'leaflet-ajax/dist/leaflet.ajax.min.js' %}"></script>
    <script src="{% static 'fuse.js/src/fuse.js' %}"></script>
    <script src="{% static 'leaflet-fusesearch-master/src/leaflet.fusesearch.js' %}"></script>
    <link rel="stylesheet" href="{% static 'leaflet-fusesearch-master/src/leaflet.fusesearch.css' %}">
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css"/>
    <link rel="stylesheet" href="{% static 'leaflet.awesome-markers.css' %}" />
    <link rel="stylesheet"  href="{% static 'awesome-bootstrap-checkbox.css' %}" />
    <script src="{% static 'leaflet.awesome-markers.min.js' %}"></script>
    <script src="https://use.fontawesome.com/2c3856b3e5.js"></script>

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="{% static 'ie10-viewport-bug-workaround.css' %}" rel="stylesheet">

    <title> Tenants Talk</title>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

  </head>
  <body>
    <div class="header clearfix">
        <nav style="background-color: black" class="navbar navbar-inverse">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <h3 style="color: white">Tenants Talk</h3>
            </div>

            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav nav-pills pull-right">
                    <input type="hidden" id="selected_menu_item" value="=$selectedMenuId; ?>" />
                    <li role="presentation" ><a href="{% url 'index' %}">Report a Landlord</a></li>
                    <li role="presentation" class="active"><a href="{% url 'map' %}">Tenant Complaint Registry</a></li>
                    <li role="presentation"><a href="/contest">Tenant Robot Lawyer</a></li>
                </ul>
          </div>
        </nav>
    </div>
    <div class="container-fluid">
      <div class="row">
        <div class="col-sm-9 col-md-10 main-panel">
         <h1 class="page-header header" style="text-align:center">Find an Advocate</h1>
         <nav class="navbar navbar-default navbar-fixed">
          <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#filters">
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="#">Filters:</a>
          </div>
          <div class="collapse navbar-collapse" id="filters" style="padding-top: 15px;">
            <form class="nav navbar-nav navbar-left" role="form">
                      <div class="checkbox checkbox-inline filter">
                        <input type="checkbox" class="styled" id="walkins">
                          <label for="walkins">
                            Accepts Walk-ins
                          </label>
                       </div>
                      <div class="checkbox checkbox-primary checkbox-inline filter">
                        <input type="checkbox" class="styled" id="women">
                          <label for="women">
                            Women Only
                          </label>
                       </div>
                      <div class="checkbox checkbox-danger checkbox-inline filter">
                         <input type="checkbox" id="disablity" class="styled">
                       <label for="disability">
                         People with Disabilities Only
                       </label>
                      </div>
                      <div class="checkbox checkbox-warning checkbox-inline filter">
                         <input type="checkbox" id="immigrant/refugees" class="styled">
                         <label for="immigrant/refugees">
                           Immigrants/Refugees Only
                         </label>
                       </div>
                      <div class="checkbox checkbox-success checkbox-inline filter">
                        <input type="checkbox" id="hiv" class="styled">
                          <label for="hiv">
                          People with HIV/AIDS only
                          </label>
                       </div>
                      <div class="checkbox checkbox-jewish checkbox-inline filter">
                        <input type="checkbox" id="jewish" class="styled">
                        <label for="jewish">
                          People of Jewish Descent
                        </label>
                      </div>
                  </form>
          </div>
         </nav>
          {% include "contest/fletter/advocatelist.html" %}
          <h1>Find an Advocate</h1>
          <div class="row">
            <div id="mapid" style="height:80%">
              <script>
                  //initialize map
                  var m  = L.map('mapid').setView([49.251624, -123.081344], 11);

                  var mopt = {
                      url:'https://api.tiles.mapbox.com/v4/wdamon.1c70m0jc/{z}/{x}/{y}.png?access_token=pk.eyJ1Ijoid2RhbW9uIiwiYSI6InFVV1VLMFUifQ.2Zx0T9w01EK6E-v76-z85Q',
                      options: {attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>, Icons: Font Awesome by Dave Gandy - http://fontawesome.io, Search Box: Antoine Riche - https://github.com/naomap/leaflet-fusesearch'}
                    };

                  var mq=L.tileLayer(mopt.url,mopt.options);

                  mq.addTo(m);
                  //organize layers
                  var layers = {},
                      masterLayer = L.layerGroup();

                  var genGroup = L.featureGroup();
                  masterLayer.addLayer(genGroup);
                  var womGroup = L.featureGroup();
                  masterLayer.addLayer(womGroup);
                  var hivGroup = L.featureGroup();
                  masterLayer.addLayer(hivGroup);

                  var baseMaps = {
                    "Basemap": mq
                  };

                  var overlayMaps = {
                    "General" : genGroup,
                    "Womens": womGroup,
                    "HIV/AIDS": hivGroup,
                  };
                  L.control.layers(baseMaps, overlayMaps, {hideSingleBase: 'true', position: 'bottomright'}).addTo(m);

                  masterLayer.addTo(m);

                  var searchCtrl = L.control.fuseSearch();
                  searchCtrl.addTo(m);

                  var geojsonPointLayer = {{ arb_serialized|safe }};

                  var genIcon = L.AwesomeMarkers.icon({
                      icon: 'briefcase',
                      prefix: 'fa',
                      markerColor: 'gold',
                      iconColor: 'white',
                      riseOnHover: 'True'

                    });
                  var womIcon = L.AwesomeMarkers.icon({
                        icon: 'briefcase',
                        prefix: 'fa',
                        markerColor: 'blue',
                        iconColor: 'white',
                        riseOnHover: 'True'
                    });
                  var hivIcon = L.AwesomeMarkers.icon({
                        icon: 'briefcase',
                        prefix: 'fa',
                        markerColor: 'black',
                        iconColor: '#018642',
                        riseOnHover: 'True'
                    });
                  function getMarker(f, name) {
                    if (f === 'general') {
                        return {icon: genIcon,
                                title: name}
                    } else if (f === 'women') {
                        return {icon: womIcon,
                                title: name}
                    } else if (f === 'HIV/AIDS') {
                        return {icon: hivIcon,
                                title: name}
                    }
                  }
                  var popup = L.DomUtil.create('div', 'tiny-popup', m.getContainer());

                  var geojsonPointLayerJSON = new L.geoJson(geojsonPointLayer, {
                    pointToLayer: function(feature, latlng) {
                      var popupcontents = "<div class='panel panel-info'><div class='panel-heading'>" + feature.properties.name + "</div><div class='panel-body'><p><li class='list-group-item'>Address: " + feature.properties.address + '</li></ul></div>';
                      if (feature.properties.category === "general") {
                        var marker = L.marker(latlng, getMarker(feature.properties.category, feature.properties.name)).bindPopup(popupcontents);
                        feature.layer = marker;
                        genGroup.addLayer(marker);
                      }  else if (feature.properties.category === "women") {
                        var marker = L.marker(latlng, getMarker(feature.properties.category, feature.properties.name)).bindPopup(popupcontents);
                        feature.layer = marker;
                        womGroup.addLayer(marker);
                      } else if (feature.properties.category === "HIV/AIDS") {
                        var marker = L.marker(latlng, getMarker(feature.properties.category, feature.properties.name)).bindPopup(popupcontents);
                        feature.layer = marker;
                        hivGroup.addLayer(marker);
                      }
                  },
                });
                searchCtrl.indexFeatures(geojsonPointLayer, ['name', 'address', 'phone']);
              </script>
            </div>
            </div>
          </div>
      </div>

      <footer class="footer">
        <p>&copy; <a href="www.wgdamon.com">William Damon</a> 2016</p>
      </footer>

    </div> <!-- /container -->
<script>
//on clicking a filter button ajax returns json data that matches the filter
//map loads with values set to clicked.  On 'unclick' divs removed from map.
$('#checkbox1').change(function() {
       if($(this).is(":checked")) {
           var returnVal = confirm("Are you sure?");
           $(this).attr("checked", returnVal);
       }
       $('#textbox1').val($(this).is(':checked'));
   });
});
$('.filter').change(function(){
  var element = $(this);
  var checked = $('filter:checkbox:checked').map(function(){
    return this.id;
  }).get();
  console.log("element.id:" + element.id);
  //checked should return a list of ids of checked boxes. Double check this is the case.
  console.log("checked:" + checked);
  // overlayadd method to add map overlay
  //if ([obj w/ layer names/element ids].contains(element.id)
  //pass the server a list of checked boxes
  $.ajax({
      url: '/contest/filter/',
      method : 'GET',
      data : { checked:checked },
      success : function(json){
        alert(data);
        //render the #advocates with the new results.
        $('#advocates').html(data);
      }
  });
});





</script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="{% static 'ie10-viewport-bug-workaround.js' %}"></script>
  </body>
</html>
